<div class="container-fluid" >
    <div class="row" style="padding: 0px;">
        <div class="col-md-1 list-group" style="padding: 0px;">
            <div class="sidebar-menu">
	        <a style="background-color: #ddd;" href="#userMeun" class="list-group-item menu-first " data-toggle="collapse"><i class="icon-user-md icon-large"></i> 询价管理</a>
		    <ul id="userMeun" class="nav nav-list menu-second panel-collapse collapse in">
<!--
		        <li><a  href="/new_pcb_order?new=true"><i ></i> 新建询价</a></li>
-->
			<li><a  href="/pcb_order_list?new=true"><i ></i> 询价草稿</a></li>
                        <% if can? :work_d, :all %>
			<li><a href="/pcb_order_list?bom_chk=true"><i class="icon-edit"></i> 询价结果</a></li>
                        <% elsif can? :work_g, :all %>
                        <li><a href="/pcb_order_list?quote=true"><i class="icon-edit"></i> 询价结果</a></li>
                        <% elsif can? :work_g, :all %>
                        <li><a href="/pcb_order_list"><i class="icon-edit"></i> 询价结果</a></li>
                        <% end %>
                    </ul>
		<a style="background-color: #ddd;" href="#articleMenu" class="list-group-item menu-first" data-toggle="collapse"><i class="icon-book icon-large"></i> 订单中心</a>
		    <ul id="articleMenu" class="nav nav-list menu-second panel-collapse collapse">
                        <li><a href="/pi_draft_list"><i></i> PI草稿箱</a></li>
			<li><a href="/pcb_order_list?place_an_order=true"><i></i> 下单审批</a></li>
			<li><a href="#"><i></i> 等待财务审批</a></li>
			<li><a href="#"><i></i> 等待采购下单</a></li>
			<li><a href="#"><i></i> 等待入库</a></li>
			<li><a href="#"><i></i> 已经入库</a></li>
	            </ul>
            </div>
        </div>
        <div class="col-md-11" style="padding-top: 10px;"><small>
        <%= form_tag('/update_pcb_order', method:"post") do %>
            <div class="row "><div class="col-md-12">                
                <div class="panel panel-info">
                    <div class="panel-heading"><strong>询价基本信息:</strong></div>
                    <div class="panel-body ">  
                   
                        <div class="col-md-2"><p><strong>询价单号 : </strong><ins id="p_no_show" name="p_no_show"><%= @q_order.order_no %></ins></p><input type="text" class="form-control sr-only" id="p_no" name="p_no" value="<%= @q_order.order_no %>">
                        </div>

                        <div class="col-md-4 form-inline"><strong>项目名称 : </strong><input type="text" class="form-control input-sm" style="width:75%" id="p_name" name="p_name" value="<%= @q_order.p_name %>">
                        </div>
                        <div class="col-md-2 form-inline"><strong>日期 : </strong><ins id="p_riqi_show" name="p_riqi_show"><%= Time.new.strftime("%Y-%m-%d")%></ins>
                                <input type="text" class="form-control sr-only" id="p_riqi" name="p_riqi" >
                        </div> 
                        <div class="col-md-2 form-inline"><strong>交货日期 : </strong><ins></ins>
                                <input type="text" class="form-control sr-only" id="p_pi1" name="p_pi1" >
                        </div>
                        <div class="col-md-1 form-inline"><strong>美金汇率 : </strong><ins></ins>
                                <input type="text" class="form-control sr-only" id="p_pi2" name="p_pi2" >
                        </div>  
                        <div class="col-md-1 form-inline"><strong>修改次数 : </strong><ins></ins>
                                <input type="text" class="form-control sr-only" id="p_pi3" name="p_pi3" >
                        </div>  
                    </div>
                </div>
            </div></div>



            <div class="row "><div class="col-md-12">
                <div class="panel panel-info">
                    <div class="panel-heading"><strong>业务员信息</strong></div>
                    <div class="panel-body ">                     
                        <div class="row ">
                            <div class="col-md-2"><strong>制单人：</strong><ins id="zhidanren_show" name="zhidanren_show"><%= User.find_by(email: @q_order.order_sell).full_name %></ins></div> 
                            <div class="col-md-2"><strong>部门：</strong><ins id="bumen_show" name="bumen_show"><%= @q_order.team %></ins></div> 
                            <div class="col-md-2"><strong>制单人电话：</strong><ins id="lianxifangshi_show" name="lianxifangshi_show"><%= @q_order.phone %></ins></div> 
                        </div>
                    </div>
                </div>
            </div></div>


            <div class="row "><div class="col-md-12">
            <div class="panel panel-info">
                <div class="panel-heading"><strong>客户信息</strong> <button type="button" class="btn btn-primary btn-xs  navbar-right" data-toggle="modal" data-target="#find_c" style="margin-right: 5px;" >选择客户</button></div>
                <div class="panel-body ">                     
                    <div class="row ">
                        <div class="col-md-2"><strong>客户代码：</strong><ins id="daima_show" name="daima_show"><%= @q_order.c_code %></ins><input type="text" class="input-sm sr-only" style="width:65%" id="daima" name="daima" readonly></div>
                        <div class="col-md-4"><strong>客户信息：</strong><ins id="kehu_show" name="kehu_show"><%= @q_order.c_des %></ins><input type="text" class="input-sm sr-only" style="width:80%" id="kehu" name="kehu" readonly></div> 
                         <div class="col-md-2"><strong>国家：</strong><ins id="guojia_show" name="guojia_show"><%= @q_order.c_country %></ins><input type="text" class="input-sm sr-only" style="width:80%" id="guojia" name="guojia" readonly></div>   
                        
                    </div>
                    <div class="row " style="padding-top: 10px;">
                         <div class="col-md-12"><strong>客户收货地址：</strong><ins id="fahuodizhi_show" name="fahuodizhi_show"><%= @q_order.c_shipping_address %></ins><input type="text" class="input-sm sr-only" style="width:90%" id="fahuodizhi" name="fahuodizhi" readonly></div> 
  
                    </div>
                </div>
            </div>

            </div></div>

<% if params[:c_id]%>
            <div class="row "><div class="col-md-12">
                <button  type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#additem" >添加询价物料</button>
            </div></div>
<% end %>



            <div class="row "><div class="col-md-12">
            <div class="panel panel-info">                
                <table class="table table-hover">
                    <thead>
                        <tr style="background-color: #eeeeee">
                            <th width="40">操作</th>
                            <th width="150">物料编码</th>
                            <th >物料名称</th>
                            <th width="70">数量</th>
                            <th >英文描述</th>
                            <th >中文描述</th>
                            <th width="100">类别</th>
                            <th width="100">总价</th>
                            <th width="100">单价</th>
                            <th width="50">附件</th>
                            <th >备注</th>
                            <th width="40">删除</th>
                        </tr>
                    </thead>
                    <tbody id="biaoge">
                        <% if @q_order_item %>
                        <% @q_order_item.each do |q_item| %>
                        <tr>
                            <td>
                                <a class="glyphicon glyphicon-edit" data-toggle="modal" data-target="#edititem" data-edit_c_item_id="<%= q_item.id %>"  data-edit_moko_code="<%= q_item.moko_code %>" data-edit_moko_des="<%= q_item.moko_des %>" data-edit_p_type="<%= q_item.p_type %>" data-edit_des_en="<%= q_item.des_en %>" data-edit_des_cn="<%= q_item.des_cn %>" data-edit_qty="<%= q_item.qty %>" data-edit_follow_remark="<%= q_item.remark %>"></a>
                            </td>
                            <td><%= q_item.moko_code %></td>
                            <td><%= q_item.moko_des %></td>
                            <td><%= q_item.qty %></td>
                            <td><%= q_item.des_en %></td>
                            <td><%= q_item.des_cn %></td>
                            <td><%= q_item.p_type %></td>
                            <td><%= q_item.t_p %></td>
                            <td><%= q_item.price %></td>
                            <td>
                                <% if not q_item.att.blank? %>                 
                                    <a class="btn btn-info btn-xs" href="<%= q_item.att %>" target="_blank">下载</a>
                                <% end %>
                            </td>
                            <td><%= q_item.remark %></td>
                            <td><a class="glyphicon glyphicon-remove" href="/del_pcb_order_item?edit_c_item_id=<%= q_item.id %>" data-confirm="确定要删除?"></a></td>
                        </tr>
                        <% end %>
                        <% end %>
                    </tbody>
                </table>             
            </div>
            </div></div>

            <div class="row ">             
                <div class="col-md-4" >
                    <div class="panel panel-info" >
                        <div class="panel-heading" ><strong>特殊备注</strong></div>                          
                        <div class="panel-body " style="margin: 0px;padding: 0px;">                     
                            <textarea rows="7" class="form-control" id="teshu_remark" name="teshu_remark"><%= @q_order.follow_remark %></textarea>
                        </div>
                    </div>
                </div> 
            </div> 

            <div class="row "><div class="col-md-12">   
                <div class="modal-footer">                    
                    <%= submit_tag "保存到草稿", class:"btn btn-success" %>
                    <% if can? :work_e, :all %>
                        <%= submit_tag "提交", class: "btn btn-info",data:{confirm: "确定要提交到BOM工程师?"} %>
                    <% elsif can? :work_d, :all %>
                        <%= submit_tag "提交", class: "btn btn-info",data:{confirm: "确定要提交到采购工程师?"} %>
                    <% elsif can? :work_g, :all %>
                        <%= submit_tag "提交", class: "btn btn-info",data:{confirm: "确定已经完成报价?"} %>
                    <% end %>
                </div>
            </div></div>
       <% end %>
       </small></div>





















<div class="modal fade" id="edititem" tabindex="-1" role="dialog" aria-labelledby="edititemLabel">
<div class="modal-dialog modal-lg"><small>
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="edititemLabel"><strong>修改询价物料</strong></h4>
        </div>
        
        <div class="modal-body">
<% if can? :work_g, :all %>
            <%= form_tag({action: :edit_pcb_order_item},method:"post",multipart:"ture",id: "order_form") do %>   
            <div class="form-group sr-only">         
                <label for="c_order_id" class="control-label">itemid:</label>
                <input type="text" class="form-control" id="edit_c_item_id" name="edit_c_item_id" >
            </div>  
            
            <div class="form-group">         
              <label for="p_name" class="control-label">物料代码:</label>
              <input type="text" class="form-control" id="edit_moko_code" name="edit_moko_code" readonly>
            </div> 
            <div class="form-group">         
              <label for="p_name" class="control-label">物料名称:</label>
              <input type="text" class="form-control" id="edit_moko_des" name="edit_moko_des" readonly>
            </div> 
            <div class="form-group">         
              <label for="p_name" class="control-label">类别:</label>
              <select class="form-control" id="edit_p_type" name="edit_p_type" readonly>
                  <option value="">----请选择----</option>
                  <option value="PCB">PCB</option>
                  <option value="PCBA">PCBA</option>
                  <option value="COMPONENTS">COMPONENTS</option>
              </select>
            </div> 
            
            <div class="form-group">         
              <label for="des_en" class="control-label">英文描述:</label>
              <input type="text" class="form-control" id="edit_des_en" name="edit_des_en" readonly>
            </div> 
            <div class="form-group">         
              <label for="des_cn" class="control-label">中文描述:</label>
              <input type="text" class="form-control" id="edit_des_cn" name="edit_des_cn" readonly>
            </div> 
            <div class="form-group">
              <label for="qty" class="control-label">数量:</label>
              <input type="number" class="form-control" id="edit_qty" name="edit_qty" readonly>
            </div> 
            <div class="form-group">
              <label for="qty" class="control-label">价格￥:</label>
              <input type="text" class="form-control" id="edit_price" name="edit_price" >
            </div> 
            <div class="form-group">
              <label for="follow_remark" class="control-label">备注:</label><code>注意：如果需要多个数量的报价，请在备注中包含要报价的数量。</code>
              <textarea  class="form-control" id="edit_follow_remark" name="edit_follow_remark" readonly></textarea>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <input type="submit" class="btn btn-primary" value="Submit" onclick="return postform_edit()">
        </div>
        <% end %>
<% else %>
            <div class="form-inline">
             <%= form_tag('/find_moko_part', method:"get", class:"form-inline",remote: true) do %>
               <div class="form-group ">
                  <lable for="order" , class="control-label"><strong>搜索物料: </strong></lable>
                  <div class="input-group input-group-sm">              
                    <%= text_field_tag :moko_part, params[:moko_part], class:"form-control input-lg", size:"60", placeholder:"物料代码/物料名称/物料描述/"%>               
                    <div class="input-group-btn">
                      <%= submit_tag "搜索", class:"btn btn-primary btn-sm" %>
                    </div>
                  </div>
              </div>
            <% end %>             
          </div> 
          <div class="form-group" id="edit_table_moko_part">


          </div>   
            <%= form_tag({action: :edit_pcb_order_item},method:"post",multipart:"ture",id: "order_form") do %>   
            <div class="form-group sr-only">         
                <label for="c_order_id" class="control-label">itemid:</label>
                <input type="text" class="form-control" id="edit_c_item_id" name="edit_c_item_id">
            </div>  
            
            <div class="form-group">
              <label for="sell_manager_remark" class="control-label">附件:</label>
              <input name="edit_att" id="edit_att" type="file" accept=".zip,.rar,.gz,.bz2,.7z" style="display: block;  text-align: right;  z-index: 999999; cursor: pointer;" ><code>注意：请上传压缩文件. (只允许上传 zip, rar, gz, bz2, 7z 文件)</code>
            </div> 
            <div class="form-group">         
              <label for="p_name" class="control-label">物料代码:</label>
              <input type="text" class="form-control" id="edit_moko_code" name="edit_moko_code" <% if can? :work_e, :all %>readonly<% end %>>
            </div> 
            <div class="form-group">         
              <label for="p_name" class="control-label">物料名称:</label>
              <input type="text" class="form-control" id="edit_moko_des" name="edit_moko_des" <% if can? :work_e, :all %>readonly<% end %>>
            </div> 
            <div class="form-group">         
              <label for="p_name" class="control-label">类别:</label>
              <select class="form-control" id="edit_p_type" name="edit_p_type">
                  <option value="">----请选择----</option>
                  <option value="PCB">PCB</option>
                  <option value="PCBA">PCBA</option>
                  <option value="COMPONENTS">COMPONENTS</option>
              </select>
            </div> 
            
            <div class="form-group">         
              <label for="des_en" class="control-label">英文描述:</label>
              <input type="text" class="form-control" id="edit_des_en" name="edit_des_en">
            </div> 
            <div class="form-group">         
              <label for="des_cn" class="control-label">中文描述:</label>
              <input type="text" class="form-control" id="edit_des_cn" name="edit_des_cn">
            </div> 
            <div class="form-group">
              <label for="qty" class="control-label">数量:</label>
              <input type="number" class="form-control" id="edit_qty" name="edit_qty">
            </div> 
            <div class="form-group">
              <label for="follow_remark" class="control-label">备注:</label><code>注意：如果需要多个数量的报价，请在备注中包含要报价的数量。</code>
              <textarea  class="form-control" id="edit_follow_remark" name="edit_follow_remark"></textarea>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <input type="submit" class="btn btn-primary" value="Submit" onclick="return postform_edit()">
        </div>
        <% end %>
<% end %>
    </div></small>
  </div>
</div>
    









<div class="modal fade" id="additem" tabindex="-1" role="dialog" aria-labelledby="additemLabel">
<div class="modal-dialog modal-lg"><small>
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="editModalLabel"><strong>添加询价物料</strong></h4>
        </div>
        
        <div class="modal-body">
            <div class="form-inline">
             <%= form_tag('/find_moko_part', method:"get", class:"form-inline",remote: true) do %>
               <div class="form-group ">
                  <lable for="order" , class="control-label"><strong>搜索物料: </strong></lable>
                  <div class="input-group input-group-sm">              
                    <%= text_field_tag :moko_part, params[:moko_part], class:"form-control input-lg", size:"60", placeholder:"物料代码/物料名称/物料描述/"%>               
                    <div class="input-group-btn">
                      <%= submit_tag "搜索", class:"btn btn-primary btn-sm" %>
                    </div>
                  </div>
              </div>
            <% end %>             
          </div> 
          <div class="form-group" id="table_moko_part">


          </div>   
            <%= form_tag({action: :add_pcb_order_item},method:"post",multipart:"ture",id: "order_form") do %>   
            <div class="form-group sr-only">         
                <label for="c_order_id" class="control-label">询价id:</label>
                <input type="text" class="form-control" id="c_order_id" name="c_order_id" value="<%= @q_order.id %>">
            </div>  
            <div class="form-group sr-only">         
                <label for="c_id" class="control-label">客户id:</label>
                <input type="text" class="form-control" id="c_id" name="c_id" value="<%= params[:c_id] %>">
            </div>  
            <div class="form-group sr-only">         
                <label for="c_order_no" class="control-label">询价单号:</label>
                <input type="text" class="form-control" id="c_order_no" name="c_order_no" value="<%= @q_order.order_no %>">
            </div>  
            <div class="form-group">
              <label for="sell_manager_remark" class="control-label">附件:</label>
              <input name="att" id="att" type="file" accept=".zip,.rar,.gz,.bz2,.7z" style="display: block;  text-align: right;  z-index: 999999; cursor: pointer;" ><code>注意：请上传压缩文件. (只允许上传 zip, rar, gz, bz2, 7z 文件)</code>
            </div> 
            <div class="form-group">         
              <label for="p_name" class="control-label">物料代码:</label>
              <input type="text" class="form-control" id="moko_code" name="moko_code" readonly>
            </div> 
            <div class="form-group">         
              <label for="p_name" class="control-label">物料名称:</label>
              <input type="text" class="form-control" id="moko_des" name="moko_des" readonly>
            </div> 
            <div class="form-group">         
              <label for="p_name" class="control-label">类别:</label>
              <select class="form-control" id="p_type" name="p_type">
                  <option value="">----请选择----</option>
                  <option value="PCB">PCB</option>
                  <option value="PCBA">PCBA</option>
                  <option value="COMPONENTS">COMPONENTS</option>
              </select>
            </div> 
            
            <div class="form-group">         
              <label for="des_en" class="control-label">英文描述:</label>
              <input type="text" class="form-control" id="des_en" name="des_en">
            </div> 
            <div class="form-group">         
              <label for="des_cn" class="control-label">中文描述:</label>
              <input type="text" class="form-control" id="des_cn" name="des_cn">
            </div> 
            <div class="form-group">
              <label for="qty" class="control-label">数量:</label>
              <input type="number" class="form-control" id="qty" name="qty">
            </div> 
            <div class="form-group">
              <label for="follow_remark" class="control-label">备注:</label><code>注意：如果需要多个数量的报价，请在备注中包含要报价的数量。</code>
              <textarea  class="form-control" id="follow_remark" name="follow_remark"></textarea>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <input type="submit" class="btn btn-primary" value="Submit" onclick="return postform()">
        </div>
        <% end %>
    </div></small>
  </div>
</div>



















<div class="modal fade" id="find_c" tabindex="-1" role="dialog" aria-labelledby="find_cLabel">
    <div class="modal-dialog modal-lg" role="document"><small>
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="find_cLabel"><strong>选择客户</strong></h4>
            </div>
      
            <div class="modal-body">        
                <div class="form-inline">
                <%= form_tag('/find_c', method:"get", class:"form-inline",remote: true) do %>
                    <div class="form-group sr-only">         
                        <label for="c_order_no" class="control-label">询价单号:</label>
                        <input type="text" class="form-control" id="c_order_no" name="c_order_no" value="<%= @q_order.order_no %>">
                    </div>
                    <div class="form-group ">
                        <lable for="order" , class="control-label"><strong>客户: </strong></lable>
                        <div class="input-group input-group-sm">              
                            <%= text_field_tag :c_code, params[:c_code], class:"form-control input-lg", size:"60", placeholder:"客户代码/客户名/客户公司名/客户联系方式"%>               
                            <div class="input-group-btn">
                                <%= submit_tag "搜索", class:"btn btn-primary btn-sm" %>
                            </div>
                        </div>
                    </div>
                <% end %>             
                </div> 
                <div class="form-group" id="table_code">


                </div>
            </div>
        </div></small>
    </div>
</div>




























    </div>
</div>










<script>
$('#edititem').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var edit_c_item_id = button.data('edit_c_item_id');
  var edit_moko_code = button.data('edit_moko_code');
  var edit_moko_des = button.data('edit_moko_des');
  var edit_p_type = button.data('edit_p_type');
  var edit_des_en = button.data('edit_des_en');
  var edit_des_cn = button.data('edit_des_cn');  
  var edit_qty = button.data('edit_qty'); 
  var edit_follow_remark = button.data('edit_follow_remark');                       
  var modal = $(this);
  modal.find($("#edit_c_item_id")).val(edit_c_item_id);
  modal.find($("#edit_moko_code")).val(edit_moko_code);
  modal.find($("#edit_moko_des")).val(edit_moko_des);
  modal.find($("#edit_p_type")).val(edit_p_type);
  modal.find($("#edit_des_en")).val(edit_des_en);
  modal.find($("#edit_des_cn")).val(edit_des_cn);
  modal.find($("#edit_qty")).val(edit_qty);
  modal.find($("#edit_follow_remark")).html(edit_follow_remark);
})




function postform_edit() {  	         
      if ($("#edit_p_type").val() == "")
      {                    
　　    alert("请选择类别！");                    
　　    return false;                
　     }
      if ($("#edit_qty").val() == "")
      {                    
　　    alert("请填写数量！");                    
　　    return false;                
　     }  
}  





function postform() {  	         
      if ($("#p_type").val() == "")
      {                    
　　    alert("请选择类别！");                    
　　    return false;                
　     }
      if ($("#qty").val() == "")
      {                    
　　    alert("请填写数量！");                    
　　    return false;                
　     }  
}  


$(".menu-first").click(function(){
  $('#userMeun').collapse('hide');
  $('#articleMenu').collapse('hide');
});
   
</script>


<%
meta title: "Quick Turn PCB Prototype and Electronic PCB Assembly Service| Fastbom.com.",
     description: "Fastbom offers Quick Turn PCB Prototype and Electronic PCB Assembly Service in low to mid volumes including PCB fabrication, parts procurement and final assembly. upload your Bill of Materials (BOM), Assembly Drawing, Fabrication Drawing (used to do incoming inspection of your PCB),  to get a fast quote.",
     keywords: "pcb assembly service, pcb assembly services, pcb assemblies, electronic assemblies, electronic assembly services, pcb prototype services, pcb prototype  service"
%>
