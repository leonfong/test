<div class="row">
  <div class="col-md-12">
    <ol class="breadcrumb">
      <li><%= link_to "所有BOM",boms_path %></li>
      <li><%= link_to @bom_item.bom.excel_file_identifier,bom_path(@bom_item.bom) %></li>
      <li class="active"><%= "BOM ##{@bom_item.id}" %></li>
    </ol>
  </div>
</div>

<div class="row">
  <div class="col-md-1"></div>

  <div class="col-md-10">

    <ul class="list-group">
      <li class="list-group-item"><h4><%= @bom_item.description %><p><%= @bom_item.part_code %></p> </h4>

    <% unless @bom_item.product_id.nil?%>

      </li>

      <li class="list-group-item"><h3><span class="label label-success">匹配</span><h3>    
      </li>

      <li class="list-group-item"><h4><%= Product.find(@bom_item.product_id).description %><p></p><p>单价：  <%= number_with_precision(Product.find(@bom_item.product_id).price/100000.0,strip_insignificant_zeros: true) %></p><p>数量：  <%= @bom_item.quantity %></p></h4></li>
    </ul>
    <% else %>
      <li class="list-group-item"><h3><span class="label label-danger">未匹配产品</span></h3></li>

    <% end %>

  </div>

</div>

<div class="row">
  <div class="col-md-1"></div>
  <div class="col-md-10">
      <p> 如果您希望指定匹配产品，请更改查询条件进行查询 </p>
      <%= form_tag edit_bom_item_path(@bom_item),:method => 'get'  do %>
        <p>
          <%= text_field_tag :q, params[:q] %>
          <%= text_field_tag :p, params[:p] %>
          <%= submit_tag "搜索", :name => nil %>
        </p>
  </div>
</div>

  <div class="row">
  <div class="col-md-1"></div>
  <div class="col-md-10">
    <table class="table table-bordered">
    <thead><tr><td><strong>在当前搜索结果中过滤：</strong></td></tr></thead>
    
    <tbody>
    
    <% unless @package2 and @ptype %>
      <tr><td>类别： <% unless @counted.nil? %> <% @counted.each do |key, value| %>  <%= link_to "#{key}(#{value})",  edit_bom_item_path(@bom_item, :part_name =>key, :q =>params[:q], :p =>params[:p]) %> <% end %><% end %></td></tr>
      <tr><td>封装： <% unless @counted1.nil? %><% @counted1.each do |key, value| %> <%= link_to "#{key}(#{value})",  edit_bom_item_path(@bom_item, :package2 =>key, :q =>params[:q], :p =>params[:p]) %> <% end %><% end %></td></tr>
    <% else %>
      <tr><td>类别： <% unless @counted.nil? %> <% @counted.each do |key, value| %>  <%= link_to "#{key}(#{value})",  edit_bom_item_path(@bom_item, :part_name =>key, :q =>params[:q], :p =>params[:p]) %> <% end %><% end %></td></tr>
      <tr><td>封装： <% unless @counted1.nil? %><% @counted1.each do |key, value| %> <%= link_to "#{key}(#{value})",  edit_bom_item_path(@bom_item, :package2 =>key, :package1 =>@ptype, :q =>params[:q], :p =>params[:p]) %> <% end %><% end %></td></tr>
    <% end %>
      
    
    </tbody>
    </table>
  </div>
  </div>

<% unless @match_products.nil? %>

  <div class="row">
    <div class="col-md-1"></div>
    <div class="col-md-10">
      <table class="table table-bordered table-striped table-hover">
        <thead>
            <tr>
              <% if current_user.email == "web@mokotechnology.com" %>
              <td>产品名称</td>
       
              <% end %>
              
              <td>产品描述</td>
              <td>价格</td>
              <td>操作</td>
            </tr>
        </thead>

        <tbody>
            <% @match_products.each do |item| %>
                <tr>
                  <% if current_user.email == "web@mokotechnology.com" %>
                  <td><%= item.name %></td>
       
                  <% end %>
                  
                  <td><%= item.description %></td>
                  <td> <%= number_with_precision(item.price/100000.0,strip_insignificant_zeros: true) %></td>
                  <td><%= link_to "确定", bom_item_path(@bom_item, :product_id =>item.id), html_options={:method =>"patch"} %></td>
                </tr>
            <% end %>
        </tbody>
        
      </table>
    </div>
    
  </div>
  
<% end %>

<div class="row">
  <div class="well">
    <%= @query_str %>
    <% end %>
  </div>
</div>
