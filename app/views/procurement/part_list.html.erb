<div class="container-fluid" >
﻿
<div class="row" style="margin: 0px;padding: 0px;" >
<br>
  <ul class="nav nav-tabs">
      <li role="presentation" class="active" ><a href="/part_list"><h4><strong><p class="text-primary"  >采购部报价列表</p></strong></h4></a></li>
      <li role="presentation" ><a href="/other_baojia"><h4><strong><p class="text-primary" >供应商批量报价工具</p></strong></h4></a></li>     
  </ul>
<br>
  <%= render 'layouts/flash_messages' %>
</div>





<div class="row" style="padding-bottom: 10px;">
   <div class="col-md-12">     
<!--
            <h3><strong>权限-采购工程师</strong></h3>
-->
            <span  style="color:#999;">
               <%= form_tag('/part_list', method:"get", class:"form-inline") do %>
               <div class="form-group  nav navbar-nav navbar-left">
                  
                  <lable for="order" , class="sr-only">Qrder : </lable>
                  <div class="input-group input-group-sm">    
                                        
                  <% if @key_order %>   
                      <%= text_field_tag :key_order, @key_order, class:"form-control  input-lg", size:"30"%>     
                  <% else %> 
                      <%= text_field_tag :key_order, params[:key_order], class:"form-control input-lg", size:"30", placeholder:"订单号/描述/MPN"%>
                  <% end %>               
                  <div class="input-group-btn">
                      <%= submit_tag "搜索", class:"btn btn-primary btn-sm" %>
                  </div>
                  
                </div>
                <a type="button" class="btn btn-success btn-sm" href="/part_list?complete=true">已经报价的物料</a>
                <a type="button" class="btn btn-warning btn-sm" href="/part_list?undone=true">等待报价的物料</a>
                <a type="button" class="btn btn-info btn-sm" href="/part_list?p_type=COM">单独采购的物料</a>
            </div>
            <% end %>                       
            </span>               
            
    </div>
</div>
  



    <div class="row" style="padding: 0px;">
        <div class="col-md-12">
<% if not @bom_item.blank? %> 
<%= will_paginate(@bom_item) %>
            <div class="row" style="padding: 0px;">
                <div class="col-md-7" style="padding-right: 0px;">
            <small>
            <table class="table table-hover" style="margin: 0px;"> 
                <thead >
                <tr style="background-color: #eeeeee"> 
                    <th width="80">分配</th> 
                    <% if params[:key_order] %>
                        <th width="150"><%= link_to "MPN",  {action: "part_list", sort_date: "mpn",key_order: params[:key_order]} %><span class="caret"></span></th>
                        <th width="150"><%= link_to "描述",  {action: "part_list", sort_date: "des",key_order: params[:key_order]} %><span class="caret"></span></th>
                    <% else %> 
                        <th width="150"><%= link_to "MPN",  {action: "part_list", sort_date: "mpn"} %><span class="caret"></span></th>
                        <th width="150"><%= link_to "描述",  {action: "part_list", sort_date: "des"} %><span class="caret"></span></th>
                    <% end %>
                    <th >MOKO 描述</th>
                    <th width="50">位号</th>
                    <th width="50">数量</th>
                    <th width="25"></th>
                    <th width="110">成本价￥</th>
                    <th width="65">小计</th>
                    <th width="60">报价</th>   
                    <th width="30"></th>                 
                </tr>
                </thead>
            </table>  </small> 
                </div>  
                <div class="col-md-5" style="padding-left: 0px;">
            <small>
            <table class="table table-hover" style="margin: 0px;"> 

                <thead >
                <tr style="background-color: #eeeeee">                   
                    <th>操作</th>
                </tr>
                </thead>
            </table>  </small> 
                </div>  </div>

                <% @bom_item.each_with_index do |item,index| %>
                <div class="row" style="padding: 0px;">
                        <div  class="col-md-7"  style="padding-right: 0px;"> 
                <small>
                <table class="table table-hover" style="margin: 0px;"> 
                <tr id="<%=item.id%>_tr" <% if item.color == "b" %>class="bg-info"<% elsif item.color == "g" %>class="bg-success"<% else %>class="bg-danger"<% end %>  >
                    <td style="padding: 5px 0px 5px 0px;margin: 0px;" width="80"><small>
                        <table class="table table-hover table-bordered" style="padding: 0px;margin: 0px;">
                            <tr>
                                <td style="padding-left: 5px;" id="<%=item.id.to_s%>_77" <% if item.user_do == 77  %>class="bg-success"<% end %>><small><a data-method='get' data-remote='true' href="/p_up_userdo?id=<%=item.id.to_s%>&user_do=77"><div >罗</div></a></small></td>
                            
                                <td style="padding-left: 5px;" id="<%=item.id.to_s%>_75" <% if item.user_do == 75  %>class="bg-success"<% end %>><small><a data-method='get' data-remote='true' href="/p_up_userdo?id=<%=item.id.to_s%>&user_do=75"><div >黄</div></a></small></td>
                                            
                                <td style="padding-left: 5px;" id="<%=item.id.to_s%>_7" <% if item.user_do == 7  %>class="bg-success"<% end %>><small><a data-method='get' data-remote='true' href="/p_up_userdo?id=<%=item.id.to_s%>&user_do=7"><div >马</div></a></small></td>
                                <td style="padding-left: 5px;" id="<%=item.id.to_s%>_999" <% if item.user_do == 999  %>class="bg-success"<% end %>><small><a data-method='get' data-remote='true' href="/p_up_userdo?id=<%=item.id.to_s%>&user_do=999"><div >供</div></a></small></td>
                            </tr>
                            <tr>                                
                                <td colSpan="4" style="padding: 0px;margin: 0px;" id="<%=item.id.to_s%>_9999" <% if item.user_do == 9999  %>class="text-center bg-success"<% else %>class="text-center"<% end %>><small><a data-method='get' data-remote='true' href="/p_up_userdo?id=<%=item.id.to_s%>&user_do=9999"><div >other</div></a></small></td>
                            </tr>
                        </table>


                    </small></td>

                    <td style="padding: 5px 0px 5px 0px;margin: 0px;" width="150"><small>
                        <table class="table table-hover table-bordered" style="padding: 0px;margin: 0px;">
                            <tr>
                                <td colSpan="3" class="text-center" style="padding: 0px;margin: 0px;"><small><a type="button" class="glyphicon glyphicon-edit" data-toggle="modal" data-target="#editMpn" data-mpn="<%= item.mpn %>" data-itempid="<%= item.id %>" id="<%= item.id.to_s + '_mpn' %>" ><%= item.mpn %></a></small></td>
                            </tr>
                            <tr id="<%= item.id.to_s + '_mpn_tr' %>">
                                <% if DigikeysStock.find_by(manufacturer_part_number: item.mpn).blank? %>
                                    <% if MousersStock.find_by(manufacturer_part_number: item.mpn).blank? %>
                                       <% if item.link.blank? or item.link == "" %>
                                           <% if item.mpn == nil or item.mpn == "" %>
                                               <td class="text-center" style="padding: 0px;margin: 0px;"><small><a style="color:#F0F0F0" class="glyphicon glyphicon-info-sign" data-container="body" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top" data-content="NO DATA"></a></small></td>
                                           <% else %>
                                               <td class="text-center" style="padding: 0px;margin: 0px;"><small><a class="glyphicon glyphicon-info-sign" data-container="body" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top" data-content="NO DATA" href="http://www.digikey.com/product-search/en?keywords=<%= item.mpn %>" target="_blank"></a></small></td>
                                           <% end %>
                                        
                                       <% else %>
                                           <% if item.link =~ /https/i %>
                                               <td class="text-center" style="padding: 0px;margin: 0px;"><small><a style="color:#FF00FF" class="glyphicon glyphicon-info-sign" data-container="body" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top" data-content="NO DATA" href="http://<%= item.link.split('https://')[-1].split(' ')[0] %>" target="_blank"></a></small></td>
                                           <% elsif item.link =~ /http/i %>
                                               <td class="text-center" style="padding: 0px;margin: 0px;"><small><a style="color:#FF00FF" class="glyphicon glyphicon-info-sign" data-container="body" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top" data-content="NO DATA" href="http://<%= item.link.split('http://')[-1].split(' ')[0] %>" target="_blank"></a></small></td>
                                           <% else %>
                                               <% if item.mpn == nil or item.mpn == "" %>
                                                   <td class="text-center" style="padding: 0px;margin: 0px;"><small><a style="color:#F0F0F0" class="glyphicon glyphicon-info-sign" data-container="body" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top" data-content="NO DATA"  ></a></small></td>
                                               <% else %>
                                                   <td class="text-center" style="padding: 0px;margin: 0px;"><small><a  class="glyphicon glyphicon-info-sign" data-container="body" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top" data-content="NO DATA" href="http://www.digikey.com/product-search/en?keywords=<%= item.mpn %>" target="_blank"></a></small></td>
                                               <% end %>
                                           <% end %>
                                       <% end %>
                            
                                       <td class="text-center" style="padding: 0px;margin: 0px;"><small><a style="color:#F0F0F0" class="glyphicon glyphicon-picture" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top" data-content="NO DATA"></a></small></td>
                                            
                                       <td class="text-center" style="padding: 0px;margin: 0px;"><small><a style="color:#F0F0F0" class="glyphicon glyphicon-file" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top" data-content="NO DATA"></a></small></td>
                                   <% else %>


                                      <% if item.link.blank? or item.link == "" %>
                                          <td class="text-center" style="padding: 0px;margin: 0px;"><small><a class="glyphicon glyphicon-info-sign" data-container="body" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top"  data-content="<%= MousersStock.find_by(manufacturer_part_number: item.mpn).description + " " + ((MousersStock.find_by(manufacturer_part_number: item.mpn).others.include?'<name>Tolerance</name><value>')? (MousersStock.find_by(manufacturer_part_number: item.mpn).others.split('<name>Tolerance</name><value>')[-1].split('</value>')[0].to_s):'') %>" href="http://www.mouser.com/Search/Refine.aspx?Keyword=<%= item.mpn %>" target="_blank"></a></small></td>
                                      <% else %>
                                          <% if item.link =~ /https/i %>
                                              <td class="text-center" style="padding: 0px;margin: 0px;"><small><a style="color:#FF00FF" class="glyphicon glyphicon-info-sign" data-container="body" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top" data-content="<%= MousersStock.find_by(manufacturer_part_number: item.mpn).description + " " + ((MousersStock.find_by(manufacturer_part_number: item.mpn).others.include?'<name>Tolerance</name><value>')? (MousersStock.find_by(manufacturer_part_number: item.mpn).others.split('<name>Tolerance</name><value>')[-1].split('</value>')[0].to_s):'') %>" href="https://<%= item.link.split('https://')[-1].split(' ')[0] %>" target="_blank"></a></small></td>
                                          <% elsif item.link =~ /http/i %>
                                              <td class="text-center" style="padding: 0px;margin: 0px;"><small><a style="color:#FF00FF" class="glyphicon gl110yphicon-info-sign" data-container="body" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top" data-content="<%= MousersStock.find_by(manufacturer_part_number: item.mpn).description + " " + ((MousersStock.find_by(manufacturer_part_number: item.mpn).others.include?'<name>Tolerance</name><value>')? (MousersStock.find_by(manufacturer_part_number: item.mpn).others.split('<name>Tolerance</name><value>')[-1].split('</value>')[0].to_s):'') %>" href="http://<%= item.link.split('http://')[-1].split(' ')[0] %>" target="_blank"></a></small></td>

                                          <% else %>
                                              <% if item.mpn == nil or item.mpn == "" %>
                                                  <td class="text-center" style="padding: 0px;margin: 0px;"><small><a style="color:#F0F0F0" class="glyphicon glyphicon-info-sign" data-container="body" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top"  data-content="<%= MousersStock.find_by(manufacturer_part_number: item.mpn).description + " " + MousersStock.find_by(manufacturer_part_number: item.mpn).others.split('<name>Tolerance</name><value>')[-1].split('</value>')[0].to_s %>" ></a></small></td>
                                              <% else %>
                                                  <td class="text-center" style="padding: 0px;margin: 0px;"><small><a class="glyphicon glyphicon-info-sign" data-container="body" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top"  data-content="<%= MousersStock.find_by(manufacturer_part_number: item.mpn).description + " " + MousersStock.find_by(manufacturer_part_number: item.mpn).others.split('<name>Tolerance</name><value>')[-1].split('</value>')[0].to_s %>" href="http://www.mouser.com/Search/Refine.aspx?Keyword=<%= item.mpn %>" target="_blank"></a></small></td>
                                              <% end %>
                                          <% end %>
                                      <% end %>
                                    
                                      <td class="text-center" style="padding: 0px;margin: 0px;"><small><a class="glyphicon glyphicon-picture" data-toggle="popoverii"  data-placement="right" data_src="<%= MousersStock.find_by(manufacturer_part_number: item.mpn).image %>" href="<%= MousersStock.find_by(manufacturer_part_number: item.mpn).image %>"  target="_blank"></a></small></td>
                                            
                                      <td class="text-center" style="padding: 0px;margin: 0px;"><small><a class="glyphicon glyphicon-file" href="<%= MousersStock.find_by(manufacturer_part_number: item.mpn).datasheets %>" target="_blank"></a></small></td>                                      



                                   <% end %>
                                <% else %>
                                    <% if item.link.blank? or item.link == "" %>
                                        <td class="text-center" style="padding: 0px;margin: 0px;"><small><a class="glyphicon glyphicon-info-sign" data-container="body" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top"  data-content="<%= DigikeysStock.find_by(manufacturer_part_number: item.mpn).description + " " + ((DigikeysStock.find_by(manufacturer_part_number: item.mpn).others.include?'<name>Tolerance</name><value>')? (DigikeysStock.find_by(manufacturer_part_number: item.mpn).others.split('<name>Tolerance</name><value>')[-1].split('</value>')[0].to_s):'') %>" href="http://www.digikey.com/product-search/en?keywords=<%= item.mpn %>" target="_blank"></a></small></td>
                                    <% else %>
                                        <% if item.link =~ /https/i %>
                                            <td class="text-center" style="padding: 0px;margin: 0px;"><small><a style="color:#FF00FF" class="glyphicon glyphicon-info-sign" data-container="body" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top" data-content="<%= DigikeysStock.find_by(manufacturer_part_number: item.mpn).description + " " + ((DigikeysStock.find_by(manufacturer_part_number: item.mpn).others.include?'<name>Tolerance</name><value>')? (DigikeysStock.find_by(manufacturer_part_number: item.mpn).others.split('<name>Tolerance</name><value>')[-1].split('</value>')[0].to_s):'') %>" href="https://<%= item.link.split('https://')[-1].split(' ')[0] %>" target="_blank"></a></small></td>
                                        <% elsif item.link =~ /http/i %>
                                            <td class="text-center" style="padding: 0px;margin: 0px;"><small><a style="color:#FF00FF" class="glyphicon glyphicon-info-sign" data-container="body" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top" data-content="<%= DigikeysStock.find_by(manufacturer_part_number: item.mpn).description + " " + ((DigikeysStock.find_by(manufacturer_part_number: item.mpn).others.include?'<name>Tolerance</name><value>')? (DigikeysStock.find_by(manufacturer_part_number: item.mpn).others.split('<name>Tolerance</name><value>')[-1].split('</value>')[0].to_s):'') %>" href="http://<%= item.link.split('http://')[-1].split(' ')[0] %>" target="_blank"></a></small></td>

                                        <% else %>
                                            <% if item.mpn == nil or item.mpn == "" %>
                                                <td class="text-center" style="padding: 0px;margin: 0px;"><small><a style="color:#F0F0F0" class="glyphicon glyphicon-info-sign" data-container="body" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top"  data-content="<%= DigikeysStock.find_by(manufacturer_part_number: item.mpn).description + " " + DigikeysStock.find_by(manufacturer_part_number: item.mpn).others.split('<name>Tolerance</name><value>')[-1].split('</value>')[0].to_s %>" ></a></small></td>
                                            <% else %>
                                                <td class="text-center" style="padding: 0px;margin: 0px;"><small><a class="glyphicon glyphicon-info-sign" data-container="body" data-toggle="popover" tabindex="0"  data-trigger="hover" data-placement="top"  data-content="<%= DigikeysStock.find_by(manufacturer_part_number: item.mpn).description + " " + DigikeysStock.find_by(manufacturer_part_number: item.mpn).others.split('<name>Tolerance</name><value>')[-1].split('</value>')[0].to_s %>" href="http://www.digikey.com/product-search/en?keywords=<%= item.mpn %>" target="_blank"></a></small></td>
                                            <% end %>
                                        <% end %>
                                    <% end %>
                                    
                                    <td class="text-center" style="padding: 0px;margin: 0px;"><small><a class="glyphicon glyphicon-picture" data-toggle="popoverii"  data-placement="right" data_src="<%= DigikeysStock.find_by(manufacturer_part_number: item.mpn).image %>" href="<%= DigikeysStock.find_by(manufacturer_part_number: item.mpn).image %>"  target="_blank"></a></small></td>
                                            
                                    <td class="text-center" style="padding: 0px;margin: 0px;"><small><a class="glyphicon glyphicon-file" href="<%= DigikeysStock.find_by(manufacturer_part_number: item.mpn).datasheets %>" target="_blank"></a></small></td>
                                <% end %>
                                
                            </tr>
                            <tr>
                                <td colSpan="3" class="text-center" style="padding: 0px;margin: 0px;"><small><%= link_to ProcurementBom.find(item.procurement_bom_id).p_name,  p_viewbom_path(bom_id: item.procurement_bom_id,bak: "bak"),target: "_blank" %></small></td>
                            </tr>
                        </table>


                    </small></td>   
<script>
function change_<%= item.id.to_s %>(){
    $("#input_<%= item.id.to_s %>").val("<%= item.description %>");
    }
</script> 
                    <% if can? :work_admin, :all or can? :work_d, :all %>
                    <td width="150" style="padding: 5px 0px 5px 0px;margin: 0px;" type="button" data-toggle="collapse" data-target="#<%= item.id.to_s + 'dow' %>" aria-expanded="false" aria-controls="<%= (index+1).to_s + 'bom' %>"  onclick="change_<%= item.id.to_s %>()"><small><%= item.description %></small></td>
                    <% else %> 
                    <td width="150" style="padding: 5px 0px 5px 0px;margin: 0px;" ><small><%= item.description %></small></td> 
                    <% end %>
                    <% if item.product_id !=0 and item.product_id != nil%>
                        <td  style="padding: 5px 0px 5px 0px;margin: 0px;">
                            <small>
                            <a class="glyphicon glyphicon-duplicate" href="/copy_data?item_id=<%=item.id.to_s%>"></a>
<!--
                            <a class="text-muted" name="<%= item.id.to_s + 'd' %>"  id="<%= item.id.to_s + 'd' %>" data-container="body" data-toggle="popover" tabindex="0"  data-trigger="focus" data-placement="top" data-content="<%= Product.find(item.product_id).name %>"><%= Product.find(item.product_id).description %></a>
-->
                            <a class="text-muted" data-method='get' data-remote='true' href="/cost_history?part_code=<%= Product.find(item.product_id).name.to_s%>&item_id=<%= item.id.to_s %>"><%= Product.find(item.product_id).description %></a>
                            </small>
                    </td>
                        
                    <% else %>
                        <td  style="padding: 5px 0px 5px 0px;margin: 0px;">
                            <small> 
                                <a class="glyphicon glyphicon-duplicate" href="/copy_data?item_id=<%=item.id.to_s%>"></a>
                                <a class="text-muted" name="<%= item.id.to_s + 'd' %>"  id="<%= item.id.to_s + 'd' %>"></a>     
                            </small>
                        </td>
                        
                    <% end %>
                    <% if item.part_code.to_s.size > 5 %>
                    <td width="50" style="padding: 5px 0px 5px 0px;margin: 0px;"><small><%= item.part_code[0,3]+"..." %></small></td>
                    <% else %>
                    <td width="50" style="padding: 5px 0px 5px 0px;margin: 0px;"><small><%= item.part_code %></small></td>
                    <% end %>
                    <td width="50" style="padding: 5px 0px 5px 0px;margin: 0px;"><small><%= item.quantity*ProcurementBom.find(item.procurement_bom_id).qty %></small></td> 

                    
                    <td width="25" style="padding: 5px 0px 5px 0px;margin: 0px;">
                      <small>                      
                          <a class="glyphicon glyphicon-trash" data-method='get' data-remote='true' href="/del_cost?id=<%=item.id.to_s%>"></a>
                      </small>
                    </td>
                    <td width="110" style="padding: 5px 0px 5px 0px;margin: 0px;">
                        <small>
                            <%= form_tag({action: :p_edit_cost_dn},method:"post",remote:"ture",class:"form-inline") do %>
          <div class="form-group sr-only">
            <label for="dn_itemid" class="control-label">itemid:</label>
            <input type="text" class="form-control" id="dn_itemid" name="dn_itemid" value="<%= item.id.to_s %>">
          </div>

                            <div class="input-group input-group-sm">
                              <input type="text" class="form-control " id="<%= item.id.to_s + 'p' %>" name="<%= item.id.to_s + 'p' %>" value="<%= item.cost.to_s %>">                      

<!--
                            <a class="text-muted" name="<%= item.id.to_s + 'p' %>" id="<%= item.id.to_s + 'p' %>"><%= "￥" + item.cost.to_s %></a>
-->                           <span class="input-group-btn ">
                               <button type="submit" class="btn btn-link  glyphicon glyphicon-ok " ></button>
                              </span>
                            </div>
                            <% end %>
                        </small>
                    </td>

<!-- 小计 报价 -->
                    <% if item.cost%>
                        <td width="65" style="padding: 5px 0px 5px 0px;margin: 0px;"><small><a class="text-muted" name="<%= item.id.to_s + 'p_t' %>" id="<%= item.id.to_s + 'p_t' %>"><%= "￥" + (item.cost*ProcurementBom.find(item.procurement_bom_id).qty*item.quantity).to_s %></a></small></td>
                    <% else %>
                        <td width="65" style="padding: 5px 0px 5px 0px;margin: 0px;"><small><a class="text-muted" name="<%= item.id.to_s + 'p_t' %>" id="<%= item.id.to_s + 'p_t' %>">￥</a></small></td>
                    <% end %>
                    <td width="60" style="padding: 5px 0px 5px 0px;margin: 0px;"><small><a class="text-muted" name="<%= item.id.to_s + 'p' %>" id="<%= item.id.to_s + 'p' %>"><%= "￥" + item.price.to_s %></a></small></td>
                    <td width="30" style="padding: 5px 0px 5px 0px;margin: 0px;"><small><a class="btn btn-info btn-xs" data-toggle="modal" data-target="#remarkitem" data-itempid="<%= item.id %>" >备<br>注</a></small></td>
                   </tr></table></small>

<div class="row" style="margin: 0px;" >
<div class="col-md-12 " style="margin: 0px;padding: 0px;background-color: #fcf8e3;" id="<%= item.id %>_item_remark">
<% PItemRemark.where(p_item_id: item.id).each do |remark_item| %>
<div class="row" style="margin: 0px;" >
<div class="col-md-12 " style="margin: 0px;padding: 0px;background-color: #fcf8e3;">
<table style="margin: 0px;" >
<tr>
<td style="padding: 0px;margin: 0px;" >
<p style="padding: 0px;margin: 0px;" >
<small >
<% if not remark_item.info.blank? %>
<a class="btn btn-info btn-xs a_ctl" href="<%= remark_item.info.url %>" target="_blank">下载</a>
<% end %>
<% if remark_item.user_id == current_user.id %>
<a type="button" class="glyphicon glyphicon-edit" data-toggle="modal" data-target="#remarkupdate" data-itempid="<%= item.id %>" data-remark_id="<%= remark_item.id %>" data-remark="<%= remark_item.remark %>" > </a>
<% end %>
<strong><%= remark_item.updated_at.localtime.strftime('%Y-%m-%d %H:%M:%S').to_s %></strong>
<strong><%= remark_item.user_name %>: </strong>
<% if remark_item.state == "del" %>
<del><%= remark_item.remark %></del>
<% else %>
<%= remark_item.remark %>
<% end %>
</small>
</p>
</td>
</tr>
</table>
</div>
</div>
<% end %>
</div>
</div>

<div class="row" style="margin: 0px;">
<div   <% if item.color == "b" %>class="col-md-12 bg-info"<% elsif item.color == "g" %>class="col-md-12 bg-success"<% else %>class="col-md-12 bg-danger"<% end %> id="<%=item.id%>_other">
<table style="margin: 0px;" >
<tr>
<td style="padding: 0px;margin: 0px;">
<p style="padding: 0px;margin: 0px;" ><small ><%= item.other %></small></p>
</td>
</tr>
</table>
</div>
</div>

<div class="row" style="margin: 0px;">
<div style="margin: 0px;padding: 0px;background-color: #fcf8e3;">
<table style="margin: 0px;" >
<tr>
<td style="padding: 0px;margin: 0px;">
<p style="padding: 0px;margin: 0px;" ><small ><%= ProcurementBom.find(item.procurement_bom_id).remark %></small></p>
</td>
</tr>
</table>
</div>
</div>






                   </div>










                   <div  class="col-md-5" style="padding-left: 0px;">
                   <table style="margin: 0px;">
                   <tr>
                   <td style="padding: 0px;margin: 0px;">
   <table class="table table-hover table-bordered " style="padding: 0px;margin: 0px;">  
   <tbody >             
        <%= form_tag({action: :p_edit},method:"post",multipart:"ture",remote:"ture",class:"form-inline") do %>  
        <tr style="padding: 0px;margin: 0px;" >
          <td width="100" style="padding: 0px;margin: 0px;">
         
            <label for="item_id" class="control-label sr-only">id:</label>
            <input type="text" class="form-control sr-only" id="item_id" name="item_id" value="<%= item.id.to_s %>">
            <label for="cost" class="control-label sr-only">价格:</label>
            <input type="text" class="form-control input-sm" id="cost" name="cost" placeholder="成本价" style="padding: 0px;margin: 0px;">

          </td>
          <td width="100" style="padding: 0px;margin: 0px;">
          
            <label for="dn" class="control-label sr-only">供应商简称:</label>
           
            <input id="dn" autocomplete="off" name="dn" type="text" class="form-control input-sm" data-provide="typeahead" data-items="8" data-source="<%= raw @all_dn %>" placeholder="供应商简称" style="padding: 0px;margin: 0px;">
          
          </td>

          <td width="100" style="padding: 0px;margin: 0px;">
          
            <label for="dn_long" class="control-label sr-only">供应商全称:</label>
            <input type="text" class="form-control input-sm" id="dn_long" name="dn_long" placeholder="供应商全称" style="padding: 0px;margin: 0px;">
          
          </td>
          <td  style="padding: 0px;margin: 0px;">
         
            <label for="remark" class="control-label sr-only">采购备注:</label>
            <input class="form-control input-sm" autocomplete="off" id="remark"  name="remark" placeholder="采购备注" data-provide="typeahead" data-items="8" data-source="[&quot;原装订货 交期12-15天&quot;,&quot;定做 交期15-20天&quot;]" style="padding: 0px;margin: 0px;">
          
          </td>
<!--          
          <td width="165" style="padding: 0px;margin: 0px;">
          
            <label for="info" class="control-label sr-only">技术资料:</label>

            <input class="form-control input-sm" name="info[info]" id="info" type="file" accept=".xls,.zip,.rar,.gz,.bz2,.7z,.pdf" >

            
          </td>
-->
          <td width="30" style="padding: 0px;margin: 0px;" id="<%= item.id.to_s + 'up' %>"><button type="submit" class="btn btn-link btn-sm glyphicon glyphicon-ok " ></button></td>
          
      </tr>    
      <% end %> 
          
      </table>
      <div class="col-md-12" style="padding: 0px;margin: 0px;" id="<%= item.id.to_s + "_dns" %>">
        <table class="table table-hover table-bordered" style="padding: 0px;margin: 0px;">

                            <tbody id="dn_<%= item.id %>_dn">
                            <% PDn.where(p_item_id: item.id,state: "").order('date DESC').each do |dn| %>
                            <tr id="<%= item.id %>_<%= dn.id %>" <% if dn.color == "b" %>class="bg-info"<% elsif dn.color == "g" %>class="bg-success"<% elsif dn.color == "y" %>class="bg-warning"<% end %> >                       
                                <td style="padding: 0px;margin: 0px;" width="55" id="<%= item.id.to_s + 'edit' %>"><small><a type="button" class="glyphicon glyphicon-edit" data-toggle="modal" data-target="#editModal" data-whatever="<%= dn.id %>" data-dn="<%= dn.dn %>" data-dnlong="<%= dn.dn_long %>" data-qty="<%= dn.qty %>" data-cost="<%= dn.cost %>" data-remark="<%= dn.remark %>" data-itemid="<%= item.id %>" > </a>
                                <% if not dn.info.blank? %>                 
                                    <a href="<%= dn.info %>">下载</a></small></td>
                                <% else %>
                                    </small></td>
                                <% end %>

                                <td style="padding: 0px;margin: 0px;" width="70"><small><a rel="nofollow" data-method="get" data-remote="true" href="/p_updateii?id=<%= item.id %>&product_name=<%=dn.part_code%>&dn_id=<%=dn.id.to_s%>&bomsuse=bomsuse" ><div><%= dn.date.localtime.strftime('%Y-%m-%d') %></div></a></small></td>

                                <td style="padding: 0px;margin: 0px;" width="200" title="<%= dn.dn_long %>"><small><a rel="nofollow" data-method="get" data-remote="true" href="/p_updateii?id=<%= item.id %>&product_name=<%=dn.part_code%>&dn_id=<%=dn.id.to_s%>&bomsuse=bomsuse" ><div><%= dn.dn %> 
<% if dn.qty.blank?%>
<%= PItem.find_by_id(dn.p_item_id).quantity*ProcurementBom.find_by_id(PItem.find_by_id(dn.p_item_id).procurement_bom_id).qty %>
<% else %>
<%= dn.qty %>
<% end %>
 ￥<%= dn.cost %></div></a></small></td> 
                              
                                
                                <td style="padding: 0px;margin: 0px;" ><small><a rel="nofollow" data-method="get" data-remote="true" href="/p_updateii?id=<%= item.id %>&product_name=<%=dn.part_code%>&dn_id=<%=dn.id.to_s%>&bomsuse=bomsuse" ><div><%= dn.remark %></div></a></small></td>
                                <td style="padding: 0px;margin: 0px;" width="15"><small><a class="glyphicon glyphicon-trash" data-method='get' data-remote='true' href="/del_dn?id=<%=dn.id.to_s%>&item_id=<%= item.id %>" data-confirm="确定要删除?"></a></small></td>
                            </tr>
                            <% end %>
                            </tbody>
                        </table> 
                   </td></tr></table>
                 </div>
                </td></tr> </div>  


<div class="row" style="padding: 0px;">
                <div class="col-md-12" style="padding-right: 0px;">
                    <tr>
                        <td  style="padding: 0px;margin: 0px;">
                            <div id="<%= item.id.to_s + 'dow' %>" class="collapse" >
                              
                                <%= form_tag('/search_m', remote: true, class:"form-inline") do %>
                                <div class="form-group">
                                    <%= text_field_tag :q, params[:q], id:"input_"+item.id.to_s, class:"form-control", size:30, value: item.description.to_s, placeholder:"Description"%>
                                    <%= text_field_tag :itemid, params[:itemid], class:"sr-only", size:2 , value: item.id.to_s %>
                                    <%= text_field_tag :id, params[:id], class:"sr-only", size:2 , value: item.id.to_s %>
                                    <%= submit_tag t(:search), class:"btn btn-primary" %>
                                </div>
                                <% end %>
<div class="row">
  <div class="col-md-12" id="<%= item.id.to_s + '_lab' %>">
  </div>
</div>


<div class="row">
  <div class="col-md-12" id="<%= item.id.to_s + '_tbody' %>">  
  </div>    
</div>
                            </div>
                        </td>
                    </tr>
</div></div>



                <% end %>




            <% end %>

           

        </div>
    </div>






<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="exampleModalLabel">New message</h4>
      </div>
      <div class="modal-body">
        <%= form_tag({action: :p_edit},method:"post",multipart:"ture") do %>
          <div class="form-group sr-only">
            <label for="item_id" class="control-label">id:</label>
            <input type="text" class="form-control" id="item_id" name="item_id">
          </div>
          <div class="form-group">
            <label for="dn" class="control-label">供应商简称:</label>
            <!--
            <input id="dn" autocomplete="off" name="dn" type="text" class="form-control " data-provide="typeahead" data-items="8" data-source="[&quot;alpha&quot;,&quot;beta&quot;,&quot;charlie&quot;,&quot;delta&quot;,&quot;epsilon&quot;,&quot;frank&quot;,&quot;gamma&quot;,&quot;trot&quot;,&quot;zulu&quot;]">
-->
            <input id="dn" autocomplete="off" name="dn" type="text" class="form-control " data-provide="typeahead" data-items="8" data-source="<%= raw @all_dn %>">
          </div>
          <div class="form-group">
            <label for="dn_long" class="control-label">供应商全称:</label>
            <input type="text" class="form-control" id="dn_long" name="dn_long">
          </div>
          <div class="form-group">
            <label for="qty" class="control-label">数量:</label>
            <input type="number" class="form-control" id="qty" name="qty">
          </div>
          <div class="form-group">
            <label for="cost" class="control-label">价格:</label>
            <input type="text" class="form-control" id="cost" name="cost">
          </div>
          <div class="form-group">
            <label for="info" class="control-label">技术资料:</label>
            <input class="form-control" name="info[info]" id="info" type="file" accept=".xls,.zip,.rar,.gz,.bz2,.7z,.pdf"  >
          </div>
          <div class="form-group">
            <label for="remark" class="control-label">备注:</label>
            <textarea class="form-control" id="remark"  name="remark"></textarea>
          </div>
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" onclick="return check_edit()">Submit</button>
      </div>
     <% end %>
    </div>
  </div>
</div>


<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="editModalLabel">New message</h4>
      </div>
      <div class="modal-body">
        <%= form_tag({action: :p_edit_dn},method:"post",remote: true,multipart:"ture") do %>
          <div class="form-group sr-only">
            <label for="dn_id" class="control-label">id:</label>
            <input type="text" class="form-control" id="dn_id" name="dn_id">
          </div>
          <div class="form-group sr-only">
            <label for="dn_item_id" class="control-label">itemid:</label>
            <input type="text" class="form-control" id="dn_item_id" name="dn_item_id">
          </div>
          <div class="form-group">
            <label for="dn" class="control-label">供应商简称:</label>
            <input id="dn_dn" autocomplete="off" name="dn_dn" type="text" class="form-control " data-provide="typeahead" data-items="8" data-source="<%= raw @all_dn %>">
          </div>
          <div class="form-group">
            <label for="dn_long" class="control-label">供应商全称:</label>
            <input type="text" class="form-control" id="dnlong" name="dnlong">
          </div>
          <div class="form-group">
            <label for="qty" class="control-label">数量:</label>
            <input type="number" class="form-control" id="dn_qty" name="dn_qty">
          </div>
          <div class="form-group">
            <label for="cost" class="control-label">价格:</label>
            <input type="text" class="form-control" id="dn_cost" name="dn_cost">
          </div> 
     
          <div class="form-group">
            <label for="info" class="control-label">技术资料:</label>
            <input class="form-control" name="dn_info[info]" id="dn_info" type="file" accept=".xls,.zip,.rar,.gz,.bz2,.7z,.pdf,.doc,.docx"  >
          </div>

          <div class="form-group">
            <label for="remark" class="control-label">备注:</label>
            <textarea class="form-control" id="dn_remark"  name="dn_remark"></textarea>
          </div>
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" >Submit</button>
      </div>
     <% end %>
    </div>
  </div>
</div>

<div class="modal fade" id="editMpn" tabindex="-1" role="dialog" aria-labelledby="editMpnLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="editMpnLabel">Update MPN</h4>
      </div>
      <div class="modal-body">
        <%= form_tag({action: :p_edit_mpn},method:"post",remote: true) do %>
          <div class="form-group sr-only">
            <label for="itemp_id" class="control-label">itemid:</label>
            <input type="text" class="form-control" id="itemp_id" name="itemp_id">
          </div>
          
          <div class="form-group">
            <label for="item_mpn" class="control-label">MPN:</label>
            <input type="text" class="form-control" id="item_mpn" name="item_mpn">
          </div>       
          
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" >Submit</button>
      </div>
     <% end %>
    </div>
  </div>
</div>


<div class="modal fade" id="cost_history" tabindex="-1" role="dialog" aria-labelledby="cost_historyLabel">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="cost_historyLabel">History Cost</h4>
      </div>
      <div class="modal-body">
          <div class="form-group" id="cost_history_list">

          </div>       
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="remarkitem" tabindex="-1" role="dialog" aria-labelledby="remarkitemLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="remarkitemLabel">备注</h4>
      </div>
      <div class="modal-body">
        <%= form_tag({action: :p_item_remark},method:"post",remote: true) do %>
          <div class="form-group sr-only">
            <label for="itemp_id_remark" class="control-label">itemid:</label>
            <input type="text" class="form-control" id="itemp_id_remark" name="itemp_id">
          </div>
          
          <div class="form-group">
            <label for="pj_remark">备注：</label>
            <textarea type="text" class="form-control" id="item_remark" name="item_remark"  ></textarea>
          </div>             
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" >Submit</button>
      </div>
     <% end %>
    </div>
  </div>
</div>

<div class="modal fade" id="remarkupdate" tabindex="-1" role="dialog" aria-labelledby="remarkupdateLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="remarkupdateLabel">备注更新</h4>
      </div>
      <div class="modal-body">
        <%= form_tag({action: :p_item_remark_up},method:"post",remote: true) do %>
          <div class="form-group sr-only">
            <label for="itemp_id_remark" class="control-label">itemid:</label>
            <input type="text" class="form-control" id="itemp_id_remark_up" name="itemp_id">
          </div>
          <div class="form-group sr-only">
            <label for="itemp_id_remark" class="control-label">itemid:</label>
            <input type="text" class="form-control" id="remark_id_up" name="remark_id">
          </div>
          
          <div class="form-group">
            <label for="pj_remark">备注：</label>
            <textarea type="text" class="form-control" id="item_remark_up" name="item_remark"  ></textarea>
          </div>             
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" >Submit</button>
      </div>
     <% end %>
    </div>
  </div>
</div>

<%= will_paginate(@bom_item) %>

</div>
</div>





<%= form_tag('/p_del_bom', remote: true, method:"post", class:"form-inline") do %>
        <%= text_field_tag :id, params[:id], class:"sr-only", size:200, value: "" %>
        <%= submit_tag t(:search), class:"btn-del  sr-only", id:"btn-del" %>
<% end %>
<script>

function check_edit(){
    //if($("#cost").val() == ""){
        //alert("Please enter your 价格.");                    
　　      //return false;    
   // }
    //if($("#dn").val() == ""){
        //alert("Please enter your 供应商.");                    
　　      //return false;    
    //}
}

window.actionEvents = {
    'click .btn-d': function (e, value, row, index) {
            $("#id").val(row.id);
            $("#btn-del").click();
            $table.bootstrapTable('remove', {
                field: 'mpn',
                values: [row.mpn]
            });
    }
};
$(document).ready(function() {
    $(".del-btn").click(function(){
        
    });
});

$('#exampleModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var recipient = button.data('whatever') // Extract info from data-* attributes
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  var modal = $(this)
  modal.find('.modal-title').text('New ' + recipient)
  modal.find($("#item_id")).val(recipient)
})
$('#editMpn').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var itempid = button.data('itempid');
  var mpn = button.data('mpn');
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  var modal = $(this);
  modal.find($("#itemp_id")).val(itempid);
  modal.find($("#item_mpn")).val(mpn);
})
$('#remarkitem').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var itempid = button.data('itempid');
  var modal = $(this);
  modal.find($("#itemp_id_remark")).val(itempid);
})
$('#remarkupdate').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var itempid = button.data('itempid');
  var remark_id = button.data('remark_id');
  var remark_up = button.data('remark');
  var modal = $(this);
  modal.find($("#itemp_id_remark_up")).val(itempid);
  modal.find($("#remark_id_up")).val(remark_id);
  modal.find($("#item_remark_up")).val(remark_up);
})
$('#editModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal;
  var recipient = button.data('whatever'); // Extract info from data-* attributes
  var cost = button.data('cost'); 
  var dn = button.data('dn');
  var dnlong = button.data('dnlong');
  var qty = button.data('qty');
  var remark = button.data('remark');
  var itemid = button.data('itemid');
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  var modal = $(this);
  modal.find('.modal-title').text('Edit ' + recipient);
  modal.find($("#dn_id")).val(recipient);
  modal.find($("#dn_cost")).val(cost);
  modal.find($("#dn_dn")).val(dn);
  modal.find($("#dnlong")).val(dnlong);
  modal.find($("#dn_qty")).val(qty);
  modal.find($("#dn_remark")).val(remark);
  modal.find($("#dn_item_id")).val(itemid);
})
</script>
<script>$(function () 
      { $("[data-toggle='popover']").popover();
      });
</script>
<script>$(function () 
      { $("[data-toggle='popoverii']").popover({
       html: true,
       trigger: 'hover',
       content: function () {
         return '<img src="'+$(this).attr('data_src') + '" />';
       }
      });
      
      });
</script>

<script>
var localObjectData = [{ id: 1, name: 'beijing' }, { id: 2, name: 'shanghai' }, { id: 3, name: 'guangzhou' }, { id: 4, name: 'sz' }];
var objMap = {};
function parseLocalObjectData() {
           
            $("#local_object_data").typeahead({
                source: function (query, process) {
                    var names = [];
                    $.each(localObjectData, function (index, ele) {
                        objMap[ele.name] = ele.id;
                        names.push(ele.name);
                    });
                    process(names);
                },
                afterSelect: function (item) {
                    console.log(objMap[item]);
                }
            });
        }
</script>
<%
meta title: "Quick Turn PCB Prototype and Electronic PCB Assembly Service| Fastbom.com.",
     description: "Fastbom offers Quick Turn PCB Prototype and Electronic PCB Assembly Service in low to mid volumes including PCB fabrication, parts procurement and final assembly. upload your Bill of Materials (BOM), Assembly Drawing, Fabrication Drawing (used to do incoming inspection of your PCB),  to get a fast quote.",
     keywords: "pcb assembly service, pcb assembly services, pcb assemblies, electronic assemblies, electronic assembly services, pcb prototype services, pcb prototype  service"
%>
