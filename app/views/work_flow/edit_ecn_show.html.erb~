<div class="container-fluid" >
 
    <div class="row" style="padding: 0px;">
        <div class="col-md-1 list-group" style="padding: 0px;">
            <%= render partial: "work_flow/menu", locals: {selected: "ecn_list"} %>
        </div>
        <div class="col-md-11" style="padding-top: 10px;">
           

        




<%= form_tag({action: :edit_ecn_up},method:"post",multipart:"true") do %>
        <div class="row">
            <div class="col-md-6 col-sm-6 " >
                <h2 style="padding-top:0px;margin-top:0px;"><span class="label label-default">工程变更通知(ECN)</span></h2>
            </div>
            <div class="col-md-6 col-sm-6">
                <input class="sr-only" name="bom_ecn_info_id" id="bom_ecn_info_id" type="text" value="<%= @get_ecn_info.id %>">
<% if can? :work_d, :all and @get_ecn_info.state == "checking" %>

                <%= submit_tag "审批通过", class:"btn btn-danger pull-right",data:{confirm: "确定审批通过?"} %>

<% end %>

            </div>
        </div>
      

        <div class="row" >
            <div class="col-md-12 col-sm-12" >
                <div class="panel panel-danger">
                    <div class="panel-heading">
                        <strong>ECN</strong>
                    </div>
                    <div class="panel-body" style="padding: 15px 15px 1px;">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-horizontal">
                                    <div class="form-group form-group-sm">
                                        <label class="col-md-4 control-label" for="c_code">BOM编号:</label>
                                        <div class="col-md-8">
                                            
                                            <p class="form-control-static" id="bom_no"><%= @get_ecn_info.bom_no %></p>

                                        </div>
                                    </div>
                                    <div class="form-group form-group-sm">
                                        <label for="voucher_item" class="col-md-4 control-label">产品型号:</label>
                                        <div class="col-md-8" >
                                            <p class="form-control-static" id="c_code_show" ></p>
                                        </div>
                                    </div>
                                    <div class="form-group form-group-sm">
                                        <label for="voucher_item" class="col-md-4 control-label">变更原因:</label>
                                        <div class="col-md-8" >
                                           
                                            <p class="form-control-static" id="bom_no"><%= @get_ecn_info.remark %></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-horizontal">
                                    <div class="form-group form-group-sm ">
                                        <label for="xianjin_kemu" class="col-md-3 control-label">签署:</label>   
                                        <div class="col-md-9">
                                            <p class="form-control-static" id="" ><%= current_user.full_name %></p>    
                                        </div>
                                    </div>
                                    <div class="form-group form-group-sm">
                                        <label for="voucher_bank_name" class="col-md-3 control-label">发起人:</label>
                                        <div class="col-md-9" >
                                            
                                            <p class="form-control-static" id="" ><%= current_user.full_name %></p>
                                        </div>
                                    </div>
                                    <div class="form-group form-group-sm">
                                        <label for="voucher_bank_account" class="col-md-3 control-label">审核:</label>
                                        <div class="col-md-9" >
                                            
                                        </div>
                                    </div>
                                    <div class="form-group form-group-sm">
                                        <label for="" class="col-md-3 control-label">批准:</label>
                                        <div class="col-md-9" >
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-horizontal">
                                    <div class="form-group form-group-sm">
                                        <label for="finance_at" class="col-md-4 control-label">日期:</label>
                                        <div class="col-md-8">
                                            <p class="form-control-static" id="bom_no"><%= @get_ecn_info.send_at.localtime.strftime('%Y-%m-%d') %></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-horizontal">
                                    <div class="form-group form-group-sm">
                                        <label for="change_at" class="col-md-4 control-label">变更性质:</label>
                                        <div class="col-md-8">




                                <label class="checkbox-inline">
                                    <input type="radio" value="ever" name="change_type[]" id="change_type_ever" <% if @get_ecn_info.change_type == "ever" %> checked <% end %> disabled>
                                    <strong>永久</strong>
                                </label>


                                <label class="checkbox-inline">
                                    <input type="radio" value="temp" name="change_type[]" id="change_type_temp" <% if @get_ecn_info.change_type == "temp" %> checked <% end %> disabled>
                                    <strong>临时</strong>
                                </label>
                                          





                                        </div>
                                    </div>
                                </div>







                                <div class="form-horizontal">
                                    <div class="form-group form-group-sm">
                                        <label for="finance_at" class="col-md-4 control-label">执行时间:</label>
                                        <div class="col-md-8">
<!--
                                            <%= text_field_tag :finance_at, params[:finance_at], id: "finance_at",class:"form-control input-sm", size:"10" %>
<script type="text/javascript">
    $(function () {
        $('#finance_at').datetimepicker({
            useCurrent: false,
            format: 'YYYY-MM-DD'
        });    
    });
</script>
-->
                                        </div>
                                    </div>
                                </div>
                                <div class="form-horizontal">
                                    <div class="form-group form-group-sm">
                                        <label for="finance_at" class="col-md-4 control-label">BOM修改时间:</label>
                                        <div class="col-md-8">
<!--
                                            <%= text_field_tag :finance_at, params[:finance_at], id: "finance_at",class:"form-control input-sm", size:"10" %>
<script type="text/javascript">
    $(function () {
        $('#finance_at').datetimepicker({
            useCurrent: false,
            format: 'YYYY-MM-DD'
        });    
    });
</script>
-->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-danger">
                    <div class="panel-heading">
                        <strong>ECN</strong>
                    </div>
                    <div class="row">
                        <div class="col-md-2">
                            <label for="recipient-name" class="control-label">生效:</label>
                        </div>
                        <div class="col-md-2">
                            <div class="checkbox-inline">
                                <label>
                                     <input type="checkbox" value="a" name="sheng_xiao_type[]" id="sheng_xiao_type_a" <% if @get_ecn_info.sheng_xiao_type == "a" %> checked <% end %>>
                                     <strong>立即更改</strong>
                                </label>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="checkbox-inline">
                                <label>
                                    <input type="checkbox" value="b" name="sheng_xiao_type[]" id="sheng_xiao_type_b" <% if @get_ecn_info.sheng_xiao_type == "b" %> checked <% end %>> 
                                    <strong>批量变更</strong>
                                </label>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="checkbox-inline">
                                <label>
                                    <input type="checkbox" value="c" name="sheng_xiao_type[]" id="sheng_xiao_type_c" <% if @get_ecn_info.sheng_xiao_type == "c" %> checked <% end %>>
                                    <strong>自然汰换</strong>
                                </label>
                            </div> 
                        </div>
                        <div class="col-md-2">
                            <div class="checkbox-inline">
                                <label>
                                    <input type="checkbox" value="d" name="sheng_xiao_type[]" id="sheng_xiao_type_d" <% if @get_ecn_info.sheng_xiao_type == "d" %> checked <% end %>>
                                    <strong>消耗库存</strong>
                                </label>
                            </div> 
                        </div>
                        <div class="col-md-2">
                            <div class="checkbox-inline">
                                <label>
                                    <input type="checkbox" value="e" name="sheng_xiao_type[]" id="sheng_xiao_type_e" <% if @get_ecn_info.sheng_xiao_type == "e" %> checked <% end %>>
                                    <strong>其它</strong>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
<% end %>

        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-danger">
                    <div class="panel-heading">
                        <strong>ECN</strong> 
                    </div>
                            <table class="table table-bordered" >
                                <colgroup>
                                    <col width=4%></col>
                                    <col width=10%></col>
                                    <col width=10%></col>
                                    <col width=15%></col>
                                    <col width=3%></col>
                                    <col width=10%></col>
                                    <col width=10%></col>
                                    <col width=15%></col>
                                    <col width=3%></col>
                                    <col width=30%></col>
                                </colgroup>
                                <thead>
                                    <tr class="active">
                                        <th rowspan="2">代号</th>
                                        <th colspan="4">变更前</th>
                                        <th colspan="4">变更后</th> 
                                        <th rowspan="2">备注</th>
                                    </tr>
                                    <tr class="active">
                                        <th >位号</th>
                                        <th >华创编码</th> 
                                        <th >华创描述</th>
                                        <th >用量</th>
                                        <th >位号</th>
                                        <th >华创编码</th> 
                                        <th >业务描述</th>
                                        <th >用量</remarkupdateth>
                                    </tr>
                                </thead>
                                <tbody>  
                                <% if not@get_ecn_item.blank?%>
                                <% @get_ecn_item.each_with_index do |item,index| %>
                                    <tr> 
                                        <td><%= item.bom_item_id %></td>
                                        <td style="word-break : break-all; "><%= item.old_part_code %></td>
                                        <td><%= item.old_moko_part %></td>
                                        <td><%= item.old_moko_des %></td>
                                        <td><%= item.old_quantity %></td>
                                        <td style="word-break : break-all; "><%= item.new_part_code %></td>
                                        <td><%= item.new_moko_part %></td>
                                        <td><%= item.new_sell_des %></td>
                                        <td><%= item.new_quantity %></td>
                                        <td><%= item.remark %></td>
                                    </tr> 
                                <% end %>
                                <% end %>
                                </tbody>  
                            </table>
                </div>
            </div>
        </div>




        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <strong>BOM</strong>
                    </div>

                            <table class="table table-bordered" >
                                <thead>
                                    <tr class="active">
                                        <th width="60">代号</th>
                                        <th >位号</th>
                                        <th width="200">华创编码</th> 
                                        <th >华创描述</th>
                                        <th width="45">用量</th>
                                        
                                    </tr>
                                </thead>
                                <tbody>  
                                <% @baojia.each_with_index do |item,index| %>
                                    <tr <% if item.ecn_tag == "new" %>class="bg-danger"<% end %> > 
                                        <td><%= item.id %></td>
                                        <td style="word-break : break-all; "><%= item.part_code %></td>
                                        <td><%= item.moko_part %></td>
                                        <td><%= item.moko_des %></td>
                                        <td><%= item.quantity %></td>
                                        
                                    </tr> 
                                <% end %>
                                </tbody>  
                            </table>

                </div>
            </div>
        </div>

        </div>
    </div>
</div>














</div>




<script>

$('#remarkupdate').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var bom_item_id = button.data('bom_item_id');
  var ecn_info_id = button.data('ecn_info_id');
  var old_moko_part = button.data('old_moko_part');
  var old_moko_des = button.data('old_moko_des');
  var old_part_code = button.data('old_part_code');
  var old_quantity = button.data('old_quantity');
  var modal = $(this);
  modal.find($("#bom_item_id")).val(bom_item_id);
  modal.find($("#ecn_info_id")).val(ecn_info_id);
  modal.find($("#old_moko_part")).val(old_moko_part);
  modal.find($("#old_moko_des")).val(old_moko_des);
  modal.find($("#old_part_code")).val(old_part_code);
  modal.find($("#old_quantity")).val(old_quantity);
  modal.find($("#old_moko_des_show")).text(old_moko_des);
  modal.find($("#old_part_code_show")).text(old_part_code);
  modal.find($("#old_quantity_show")).text(old_quantity);
})

$('#add_item_ecn').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var ecn_info_id = button.data('ecn_info_id_new');
  var modal = $(this);
  modal.find($("#ecn_info_id_new")).val(ecn_info_id); 
})

function get_options(value){
    var urla='/work_flow/select_pcbcustomer_ajax?id='+value;
    $("#change_s").attr("href",urla);
    $("#change_s").click(); 
  }


</script>

<script type="text/javascript">
function postform() {  	           
      if ($("#price").val() == "")
      {                    
　　    alert("请选填写报价！");                    
　　    return false;                
　     }

}  

$(".menu-first").click(function(){
  $('#userMeun').collapse('hide');
  $('#articleMenu').collapse('hide');
  $('#whMenu').collapse('hide');
});
  
</script>
<%
meta title: "Quick Turn PCB Prototype and Electronic PCB Assembly Service| Fastbom.com.",
     description: "Fastbom offers Quick Turn PCB Prototype and Electronic PCB Assembly Service in low to mid volumes including PCB fabrication, parts procurement and final assembly. upload your Bill of Materials (BOM), Assembly Drawing, Fabrication Drawing (used to do incoming inspection of your PCB),  to get a fast quote.",
     keywords: "pcb assembly service, pcb assembly services, pcb assemblies, electronic assemblies, electronic assembly services, pcb prototype services, pcb prototype  service"
%>
